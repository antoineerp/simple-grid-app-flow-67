
# Force execution of PHP scripts
<FilesMatch "\.php$">
    SetHandler application/x-httpd-php
</FilesMatch>

# Enable rewrite engine
RewriteEngine On
RewriteBase /

# Add MIME type and handler for PHP files
AddType application/x-httpd-php .php
AddHandler application/x-httpd-php .php

# Explicitly set PHP configurations
<IfModule mod_php.c>
    php_flag display_errors on
    php_value error_reporting 32767
    php_flag output_buffering on
</IfModule>

# CRITICAL: Make sure mod_php or php-cgi is properly used
<IfModule !mod_php.c>
    Action application/x-httpd-php "/usr/bin/php-cgi"
</IfModule>

# SPECIFIC FIX: Support alternative PHP handler for some hosts
<IfModule !mod_php.c>
    <IfModule !mod_php7.c>
        <IfModule fcgid_module>
            AddHandler fcgid-script .php
            FcgidWrapper /usr/local/bin/php-cgi .php
        </IfModule>
    </IfModule>
</IfModule>

# Redirect API requests to the API folder
RewriteRule ^api(/.*)?$ api$1 [L]

# Explicitly route PHP files to the PHP handler
<FilesMatch "\.php$">
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteRule ^(.*)$ $1 [L,E=SCRIPT:$1]
</FilesMatch>

# All other requests go to index.html for React routing
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(?!api/) index.html [L]

# Default index files
DirectoryIndex index.html index.php

# Set UTF-8 encoding
AddDefaultCharset UTF-8

# Disable caching for PHP files
<FilesMatch "\.php$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
</FilesMatch>
