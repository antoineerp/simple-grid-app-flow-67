
# Configuration de base
AddHandler application/x-httpd-php .php
SetHandler application/x-httpd-php

# Types MIME explicites pour assurer le bon chargement des assets
AddType text/css .css
AddType application/javascript .js
AddType application/javascript .mjs
AddType text/javascript .js .mjs
AddType image/svg+xml .svg
AddType image/png .png
AddType image/jpeg .jpg .jpeg

# Activer le moteur de réécriture
RewriteEngine On
Options +FollowSymLinks

# Activer la journalisation des erreurs pour diagnostic
RewriteLog "/tmp/rewrite.log"
RewriteLogLevel 3

# Traitement direct des fichiers PHP de diagnostic
RewriteRule ^debug-assets\.php$ debug-assets.php [L]
RewriteRule ^assets-check\.php$ assets-check.php [L]
RewriteRule ^test-ultra-simple\.php$ test-ultra-simple.php [L]
RewriteRule ^diagnostic-500\.php$ diagnostic-500.php [L]
RewriteRule ^php-error-finder\.php$ php-error-finder.php [L]
RewriteRule ^test-minimal\.php$ test-minimal.php [L]

# Permettre la navigation dans le dossier dist/assets via le navigateur (pour diagnostic)
<IfModule mod_autoindex.c>
    Options +Indexes
    <Directory "dist/assets">
        Options +Indexes
        IndexOptions FancyIndexing
    </Directory>
</IfModule>

# Traitement des fichiers d'assets sans hachage
RewriteRule ^assets/index\.js$ dist/assets/index.js [L]
RewriteRule ^assets/index\.css$ dist/assets/index.css [L]

# Traitement direct des fichiers d'assets
RewriteRule ^dist/assets/(.*)$ dist/assets/$1 [L]

# Autres chemins d'accès aux assets
RewriteRule ^assets/(.*)$ dist/assets/$1 [L]
RewriteRule ^lovable-uploads/(.*)$ lovable-uploads/$1 [L]

# Traitement des requêtes API
RewriteRule ^api/(.*)$ api/$1 [QSA,L]

# Route de secours pour SPA
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [QSA,L]
