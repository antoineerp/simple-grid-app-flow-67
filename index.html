
<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FormaCert</title>
    <link rel="icon" href="/lovable-uploads/formacert-logo.png" type="image/png">
    <meta name="description" content="FormaCert - Système de gestion de certification" />
    
    <!-- Ne définir WS_TOKEN que sur Lovable -->
    <script>
      if (window.location.hostname.includes('lovable.dev') || 
          window.location.hostname.includes('lovable.app') || 
          window.location.hostname.includes('gpteng.co')) {
        window.__WS_TOKEN__ = "lovable-ws-token";
      }
    </script>
    
    <!-- Styles avec détection auto main.css ou index.css -->
    <script>
      // Auto-détection du fichier CSS (index.css ou main.css)
      function loadCSS() {
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        
        // Essayer d'abord index.css
        fetch('/dist/assets/index.css')
          .then(response => {
            if (response.ok) {
              link.href = '/dist/assets/index.css';
            } else {
              // Fallback à main.css
              link.href = '/dist/assets/main.css';
            }
            document.head.appendChild(link);
          })
          .catch(() => {
            // Fallback vers CSS direct
            link.href = '/dist/assets/main.css';
            document.head.appendChild(link);
          });
      }
      
      // Exécuter la détection au chargement
      window.addEventListener('DOMContentLoaded', loadCSS);
    </script>
  </head>
  <body>
    <div id="root"></div>
    <noscript>
      <div style="text-align:center; margin-top:50px; font-family:sans-serif;">
        <p>Cette application nécessite JavaScript pour fonctionner.</p>
      </div>
    </noscript>
    
    <!-- Script Lovable (chargé de manière permanente) -->
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    
    <!-- Script principal avec détection automatique -->
    <script>
      // Auto-détection du fichier JS (index.js ou main.js)
      function loadScript() {
        var script = document.createElement('script');
        script.type = 'module';
        
        // Essayer d'abord index.js
        fetch('/dist/assets/index.js')
          .then(response => {
            if (response.ok) {
              script.src = '/dist/assets/index.js';
            } else {
              // Fallback à main.js
              script.src = '/dist/assets/main.js';
            }
            document.body.appendChild(script);
          })
          .catch(() => {
            // Dernier recours - fallback vers main.js
            script.src = '/dist/assets/main.js';
            document.body.appendChild(script);
          });
      }
      
      // Exécuter la détection au chargement
      window.addEventListener('DOMContentLoaded', loadScript);
    </script>
    
    <!-- Message de diagnostic en cas d'échec de chargement -->
    <script>
      // Afficher un message d'erreur après 5 secondes si l'application n'a pas chargé
      setTimeout(function() {
        if (document.getElementById('root').childElementCount === 0) {
          document.getElementById('root').innerHTML = `
            <div style="max-width:800px; margin:50px auto; padding:20px; font-family:sans-serif; line-height:1.5; color:#333; background:#f9f9f9; border:1px solid #ddd; border-radius:8px;">
              <h1 style="color:#d33;">Erreur de chargement de l'application</h1>
              <p>L'application n'a pas pu être chargée correctement. Cela peut être dû à un problème avec les fichiers statiques.</p>
              <h3>Diagnostics recommandés:</h3>
              <ul>
                <li>Visitez <a href="/assets-check.php" style="color:#0066cc;">la page de diagnostic des assets</a></li>
                <li>Vérifiez que le dossier <code>dist/assets</code> contient les fichiers <code>index.js</code> et <code>index.css</code></li>
                <li>Vérifiez si le serveur a besoin d'exécuter <code>npm run build</code></li>
              </ul>
            </div>
          `;
        }
      }, 5000);
    </script>
  </body>
</html>
