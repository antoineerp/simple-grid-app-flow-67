
# Forcer PHP à s'exécuter dans ce répertoire
AddType application/x-httpd-php .php
AddHandler application/x-httpd-php .php
AddHandler php8-fcgi .php

# Forcer explicitement PHP pour tous les fichiers .php
<FilesMatch "\.php$">
    SetHandler application/x-httpd-php
    SetHandler php8-fcgi
</FilesMatch>

# Activer la réécriture d'URL
RewriteEngine On

# Définir les types MIME corrects
AddType application/javascript .js
AddType application/javascript .mjs
AddType text/css .css
AddType application/json .json

# Gérer les requêtes OPTIONS pour CORS (important pour les API)
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# Permettre l'accès direct aux fichiers PHP spécifiques
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule \.(php)$ - [L]

# Configuration des en-têtes pour tous les fichiers PHP
<Files *.php>
    Order Allow,Deny
    Allow from all
    
    # En-têtes CORS pour les API
    <IfModule mod_headers.c>
        Header set Access-Control-Allow-Origin "*"
        Header set Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE"
        Header set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
        
        # Désactiver le cache pour les réponses API
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires 0
    </IfModule>
</Files>

# Définition d'une page d'erreur JSON personnalisée pour les erreurs
ErrorDocument 500 '{"status":"error","message":"Erreur interne du serveur","code":500}'
ErrorDocument 404 '{"status":"error","message":"Ressource non trouvée","code":404}'
ErrorDocument 403 '{"status":"error","message":"Accès interdit","code":403}'

# Forcer PHP à utiliser le bon encodage
<IfModule mod_php.c>
    php_value default_charset "UTF-8"
    php_flag display_errors Off
    php_value error_log "php_errors.log"
    php_flag log_errors On
    php_value upload_max_filesize "16M"
    php_value post_max_size "16M"
    php_value memory_limit "128M"
    php_value max_execution_time 300
</IfModule>
