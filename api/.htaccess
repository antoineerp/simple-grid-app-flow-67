
# Configuration pour assurer l'exécution PHP dans le dossier API
Options +FollowSymLinks +ExecCGI

# Activer le moteur de réécriture
RewriteEngine On

# Forcer l'exécution PHP explicitement - TRÈS IMPORTANT
<FilesMatch "\.php$">
    SetHandler application/x-httpd-php
</FilesMatch>

# S'assurer que mod_php est bien utilisé
AddType application/x-httpd-php .php
AddHandler application/x-httpd-php .php

# Activer PHP_VALUE si nécessaire
<IfModule mod_php7.c>
    php_flag display_errors on
    php_value error_reporting 32767
    php_value output_buffering 4096
</IfModule>

<IfModule mod_php.c>
    php_flag display_errors on
    php_value error_reporting 32767
    php_value output_buffering 4096
</IfModule>

# Forcer l'UTF-8 pour tous les fichiers PHP
<FilesMatch "\.php$">
    AddDefaultCharset UTF-8
</FilesMatch>

# Vérifier si login-test.php existe et rediriger les requêtes
RewriteCond %{REQUEST_URI} ^/api/login-test.php$
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^(.*)$ login-test.php [QSA,L]

# Vérifier si auth.php existe et rediriger les requêtes vers /api/auth
RewriteCond %{REQUEST_URI} ^/api/auth$
RewriteCond %{DOCUMENT_ROOT}/api/auth.php -f
RewriteRule ^(.*)$ auth.php [QSA,L]

# Rediriger vers index.php pour les autres requêtes API
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.*)$ index.php [QSA,L]

# Configuration CORS
Header set Access-Control-Allow-Origin "*"
Header set Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE"
Header set Access-Control-Allow-Headers "Content-Type, Authorization"

# Désactiver la mise en cache
Header set Cache-Control "no-cache, no-store, must-revalidate"
Header set Pragma "no-cache"
Header set Expires "0"

# Configuration UTF-8
AddDefaultCharset UTF-8

# Désactiver le module de compression si problèmes de buffering
<IfModule mod_deflate.c>
    SetEnvIfNoCase Request_URI \.php$ no-gzip dont-vary
</IfModule>
