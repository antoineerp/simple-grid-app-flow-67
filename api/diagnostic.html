
<!DOCTYPE html>
<html>
<head>
    <title>Diagnostic PHP</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow: auto; }
        button { padding: 8px 15px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #45a049; }
    </style>
</head>
<body>
    <h1>Page de diagnostic PHP</h1>
    
    <div class="card">
        <h2>1. Test de base PHP</h2>
        <p>Cette section vérifie si PHP est correctement configuré sur le serveur.</p>
        <div id="php-test-result">Chargement...</div>
        <button onclick="testPhp()">Tester PHP</button>
    </div>
    
    <div class="card">
        <h2>2. Test API JSON</h2>
        <p>Cette section vérifie si l'API renvoie correctement du JSON.</p>
        <div id="api-test-result">Chargement...</div>
        <button onclick="testApi()">Tester l'API</button>
    </div>
    
    <div class="card">
        <h2>3. Informations sur le serveur</h2>
        <div id="server-info">
            <p>URL: <span id="current-url"></span></p>
            <p>Navigateur: <span id="browser-info"></span></p>
        </div>
    </div>
    
    <div class="card">
        <h2>4. Tests de chemins d'accès</h2>
        <div id="path-tests">Chargement...</div>
        <button onclick="testPaths()">Tester les chemins</button>
    </div>

    <script>
        // Afficher l'URL actuelle et les infos navigateur
        document.getElementById('current-url').textContent = window.location.href;
        document.getElementById('browser-info').textContent = navigator.userAgent;
        
        // Test de base PHP
        async function testPhp() {
            const resultDiv = document.getElementById('php-test-result');
            resultDiv.innerHTML = 'Test en cours...';
            
            try {
                const response = await fetch('../api/simple-test.php');
                const text = await response.text();
                
                try {
                    // Essayer de parser comme JSON
                    const json = JSON.parse(text);
                    resultDiv.innerHTML = `
                        <p class="success">✅ PHP fonctionne correctement!</p>
                        <p>Version PHP: ${json.php_version}</p>
                        <p>Serveur: ${json.server_software}</p>
                        <p>Horodatage: ${json.timestamp}</p>
                    `;
                } catch (e) {
                    // Si ce n'est pas du JSON, afficher le texte brut
                    resultDiv.innerHTML = `
                        <p class="error">❌ PHP ne renvoie pas du JSON valide.</p>
                        <p>Réponse reçue:</p>
                        <pre>${escapeHtml(text)}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <p class="error">❌ Erreur lors du test PHP:</p>
                    <pre>${error.message}</pre>
                `;
            }
        }
        
        // Test API JSON
        async function testApi() {
            const resultDiv = document.getElementById('api-test-result');
            resultDiv.innerHTML = 'Test en cours...';
            
            try {
                const response = await fetch('../api/test.php');
                const text = await response.text();
                
                try {
                    // Essayer de parser comme JSON
                    const json = JSON.parse(text);
                    resultDiv.innerHTML = `
                        <p class="success">✅ L'API renvoie du JSON valide!</p>
                        <p>Statut: ${json.status || 'Non spécifié'}</p>
                        <p>Message: ${json.message || 'Non spécifié'}</p>
                        <pre>${JSON.stringify(json, null, 2)}</pre>
                    `;
                } catch (e) {
                    // Si ce n'est pas du JSON, afficher le texte brut
                    resultDiv.innerHTML = `
                        <p class="error">❌ L'API ne renvoie pas du JSON valide.</p>
                        <p>Réponse reçue:</p>
                        <pre>${escapeHtml(text)}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <p class="error">❌ Erreur lors du test de l'API:</p>
                    <pre>${error.message}</pre>
                `;
            }
        }
        
        // Test des chemins d'accès
        async function testPaths() {
            const resultDiv = document.getElementById('path-tests');
            resultDiv.innerHTML = 'Test en cours...';
            
            const paths = [
                '/api/simple-test.php',
                '/api/test.php',
                '/api/info.php',
                '/api/',
                '/index.html'
            ];
            
            let results = '<ul>';
            
            for (const path of paths) {
                try {
                    const fullPath = new URL(path, window.location.origin).href;
                    const startTime = Date.now();
                    const response = await fetch(fullPath, { method: 'GET' });
                    const endTime = Date.now();
                    
                    results += `
                        <li>
                            <strong>${path}</strong>: 
                            ${response.ok ? '<span class="success">OK</span>' : '<span class="error">Échec</span>'} 
                            (${response.status} ${response.statusText}) - 
                            ${endTime - startTime}ms
                        </li>
                    `;
                } catch (error) {
                    results += `
                        <li>
                            <strong>${path}</strong>: 
                            <span class="error">Erreur</span> - 
                            ${error.message}
                        </li>
                    `;
                }
            }
            
            results += '</ul>';
            resultDiv.innerHTML = results;
        }
        
        // Utilitaire pour échapper le HTML
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
        
        // Exécuter automatiquement les tests au chargement
        window.addEventListener('load', function() {
            setTimeout(() => {
                testPhp();
                testApi();
                testPaths();
            }, 500);
        });
    </script>
</body>
</html>
